pico-8 cartridge // http://www.pico-8.com
version 22
__lua__
-- globals
t=0
friction=0.75
max_speed=1

player={
 acc=0.5,
 x=16,
 y=16,
 dx=0,
 dy=0,
 frames={1,2,3,4},
 frame=1,
 flp=true,
 
 draw=function(self)
 	if self.dx != 0 or self.dy !=  0 then
			if t%6==0 then
			 self.frame=self.frame%#self.frames+1
 	 end
	 else
	  self.frame=1
	 end
	 spr(self.frame,self.x,self.y,1,1,self.flp)
 end,
 
 update=function(self)
  self.dx*=friction
  self.dy*=friction
  
  if btn(0) then
   self.dx-=self.acc
   self.flp=false
  end
  if btn(1) then 
   self.dx+=self.acc
   self.flp=true
  end
  if btn(2) then self.dy-=self.acc end
  if btn(3) then self.dy+=self.acc end
    
  self.dx=mid(-max_speed,self.dx,max_speed)	 
  self.dy=mid(-max_speed,self.dy,max_speed)
 	
 	local collisions=is_colliding(self.x,self.y,8,8,self.dx,self.dy)
 	if collisions.top or collisions.bottom then
   self.dy=0
 	end
 	if collisions.left or collisions.right then
   self.dx=0
 	end

 	self.x+=self.dx
 	self.y+=self.dy
 		
  if abs(self.dx)<0.05 then self.dx=0 end
  if abs(self.dy)<0.05 then self.dy=0 end
 end
}
-->8
-- main
function _init()
end

function _update60()
 t+=1
 player:update()
end

function _draw()
 cls(0)
 map()
 player:draw()
end
-->8
-- tools
function is_walkable(x,y)
 local tile=mget(x/8,y/8)
 return not fget(tile,0)
end

function is_colliding(x,y,w,h,dx,dy)
 local top=false
 local right=false
 local bottom=false
 local left=false
 
 -- moving right
 if dx>0 then
		for i=0,7 do
		 if not is_walkable(x+w,y+i) then
		  right=true
		 end
		end
 end

	if dx<0 then
	 for i=0,7 do
	  if not is_walkable(x-1,y+i) then
    left=true
   end
	 end
	end

	if dy<0 then
	 for i=0,7 do
	  if not is_walkable(x+i,y-1) then
    top=true
   end
	 end
	end
	
	if dy>0 then
	 for i=0,7 do
	  if not is_walkable(x+i,y+h) then
	 		bottom=true 
	  end
	 end
	end

 return {
	 top=top,
	 right=right,
	 bottom=bottom,
	 left=left
 }
end
__gfx__
00000000111000000000000011100000000000005555555500555555555555005555555555555555005555005555555500000000000000000000000000000000
00000000100100001110000010010000111000005555555505555555555555505555555555555555055555505555555500000000000000000000000000000000
00700700100100001001000010010000100100005555555555555555555555555555555555555555555555555555555500000000000000000000000000000000
00077000104100004001000010410000100400005555555555555555555555555555555555555555555555555555555500000000000000000000000000000000
00077000114100004111000011410000111400005555555555555555555555555555555555555555555555555555555500000000000000000000000000000000
0070070011f10000f111000011f10000111f00005555555555555555555555555555555555555555555555555555555500000000000000000000000000000000
00000000114100004111000011410000111400005555555555555555555555555555555005555555555555550555555000000000000000000000000000000000
00000000114110004111100011411000111410005555555555555555555555555555550000555555555555550055550000000000000000000000000000000000
__gff__
0000000000010101010101010000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0605050505050505050505050505050700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05000000000b0000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05000000000a0000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505080000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000605050700000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000505050500000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000505050500000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000505050500000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000060505050505050500000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000090505050505050800000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0905050505050505050505050505050800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
